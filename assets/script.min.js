var model=new Object;model={id:"1",title:"Empathy map tool to visualise user's need and behaviour",says:"<ul><li>Need to create different maps for different projects</li><li>No solidity in the user research workflow</li><li>User feedback/suggestions get cumbersome</li><li>Need to organise data to share with stakeholders</li></ul>",thinks:"<ul><li>Uses word-processor or notepad</li><li>Uses sticky notes</li><li>Scribbles on Moleskine</li><li>Keeps searching archives</li></ul>",does:"<ul><li>Uses word-processor or notepad</li><li>Uses sticky notes</li><li>Scribbles on Moleskine</li><li>Keeps searching archives</li></ul>",feels:"<ul><li>Saturated</li><li>Frustrated</li><li>Anxious</li><li>Sloppy</li></ul>"};var headString='<head><link href="https://fonts.googleapis.com/css?family=PT+Serif&display=swap" rel="stylesheet"></head><style>*{box-sizing:border-box}body{font-family:\'PT Serif\',serif;padding:24px;width:2000px;max-width:100%;margin:0 auto}h1{font-size:48px}h2{font-size:28px}ul{font-size:18px}body>div:first-of-type{display:grid;grid-template-columns:1fr 1fr}@media screen and (max-width:800px){body>div:first-of-type{grid-template-columns:1fr}}</style>',initHandler=function(){var e,t=document.querySelector(".ue-title span"),n=document.querySelectorAll(".ue-view"),s=document.querySelector(".ue-ic-projects"),o=document.querySelector(".ue-ic-mode"),i=document.querySelector(".ue-ic-credits"),c=document.querySelector(".ue-ic-save"),r=document.body,a=document.querySelector(".ue-dropaction span"),l=document.querySelector(".ue-xs-overlay"),u=document.querySelectorAll(".ue-segment"),d=document.querySelectorAll(".ue-st"),f=(document.querySelector(".ue-logo"),document.querySelectorAll(".ue-notes")),p=document.querySelectorAll(".ue-segment h2"),m=document.querySelector(".ue-project-list"),v=document.querySelector(".ue-btn-add"),h=document.querySelector(".ue-workspace"),y=document.querySelector(".ue-toolbar"),L="workspace",g=function(e){e.preventDefault();var t=(e.originalEvent||e).clipboardData.getData("text/plain");document.execCommand("insertHTML",!1,t)};if(t&&(t.addEventListener("focus",function(){var e=window.getSelection();null!=t.firstChild&&e.collapse(t.firstChild,t.firstChild.length)}),t.addEventListener("paste",function(e){g(e)})),f&&f.forEach(function(e){e.addEventListener("paste",function(e){g(e)})}),p&&p.forEach(function(e){e.addEventListener("click",function(){e.classList.contains("ue-locked")?(e.classList.remove("ue-locked"),e.nextElementSibling.setAttribute("contenteditable","true")):(e.classList.add("ue-locked"),e.nextElementSibling.setAttribute("contenteditable","false"))})}),n){var b=function(e){n.forEach(function(t){t.dataset.view!=e?t.classList.contains("ue-vw-active")&&t.classList.remove("ue-vw-active"):t.classList.contains("ue-vw-active")||t.classList.add("ue-vw-active")})};s.addEventListener("click",function(){"projects"!=L&&(H(),b(L="projects"))}),i.addEventListener("click",function(){b(L="credits")}),c.addEventListener("click",function(){let e=h.innerHTML.replace(/contenteditable="[a-zA-Z0-9:;\.\s\(\)\-\,]*"/gi,"").replace(/class="[a-zA-Z0-9:;\.\s\(\)\-\,]*"/gi,""),n=`data:text/html,<html>${headString} ${e}</html>`;""==t.textContent?this.download="uxem-unnamed-project.html":this.download=`uxem-${t.textContent.toLowerCase()}.html`,this.href=n})}if(u){if(d){d.forEach(function(e){e.addEventListener("click",function(){let t=e.dataset.bind;var n;b(L="workspace"),n=t,u.forEach(function(e){e.dataset.view!=n?e.classList.contains("ue-segment-visible")&&e.classList.remove("ue-segment-visible"):e.classList.contains("ue-segment-visible")||e.classList.add("ue-segment-visible")}),function(e){d.forEach(function(t){t.dataset.bind!=e?t.classList.contains("ue-st-visible")&&t.classList.remove("ue-st-visible"):t.classList.contains("ue-st-visible")||t.classList.add("ue-st-visible")})}(t),a.textContent=t})})}}if(o.addEventListener("click",function(){r.classList.contains("ue-dark-mode")?(r.classList.remove("ue-dark-mode"),E("off")):(r.classList.add("ue-dark-mode"),E("on"))}),a&&a.addEventListener("click",function(){l&&(l.classList.contains("ue-xs-overlay-show")||l.classList.add("ue-xs-overlay-show"),l.addEventListener("click",function(){l.classList.contains("ue-xs-overlay-show")&&(l.classList.add("ue-xs-overlay-hide"),setTimeout(function(){l.classList.remove("ue-xs-overlay-hide","ue-xs-overlay-show")},400))}))}),"Win32"===window.navigator.platform||"Linux x86_64"===window.navigator.platform){var w=document.createElement("style");w.textContent="::-webkit-scrollbar{width:8px}::-webkit-scrollbar-track{background:var(--primary-8)}::-webkit-scrollbar-thumb{background:var(--primary-86)}",document.body.appendChild(w)}var k,j=function(){var e=(window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB||window.shimIndexedDB).open("uxem",1);return e.onupgradeneeded=function(){e.result.createObjectStore("config",{keyPath:"id"}),e.result.createObjectStore("projects",{keyPath:"id"})},e},x=function(){var e=j();"unset"!=t.dataset.projectId&&(e.onsuccess=function(){var n=e.result.transaction("projects","readwrite");n.objectStore("projects").put(model={id:t.dataset.projectId,title:t.innerHTML,says:f[0].innerHTML,thinks:f[1].innerHTML,does:f[2].innerHTML,feels:f[3].innerHTML});S(),n.onsuccess=function(){e.result.close()}})},S=function(){var e=j();e.onsuccess=function(){var n=e.result.transaction("config","readwrite");n.objectStore("config").put({id:"2",lastHistory:t.dataset.projectId});n.onsuccess=function(){e.result.close()}}},E=function(e){var t=j();t.onsuccess=function(){var n=t.result.transaction("config","readwrite");n.objectStore("config").put({id:"1",darkMode:e});n.onsuccess=function(){t.result.close()}}},M=function(){var e=j();e.onsuccess=function(){var t=e.result.transaction("config","readonly"),n=t.objectStore("config").get("1");n.onsuccess=function(){n.result&&"on"==n.result.darkMode&&(r.classList.contains("ue-dark-mode")||r.classList.add("ue-dark-mode"))},t.onsuccess=function(){e.result.close()}}},T=function(){var n=j();n.onsuccess=function(){var s=n.result.transaction("projects","readonly"),o=s.objectStore("projects").get(t.dataset.projectId);o.onsuccess=function(){o.result?(t.innerHTML=o.result.title,f[0].innerHTML=o.result.says,f[1].innerHTML=o.result.thinks,f[2].innerHTML=o.result.does,f[3].innerHTML=o.result.feels,t.focus()):0==e||1==t.dataset.projectId?(t.innerHTML=model.title,f[0].innerHTML=model.says,f[1].innerHTML=model.thinks,f[2].innerHTML=model.does,f[3].innerHTML=model.feels,t.focus(),x()):"projects"!=L&&(H(),b(L="projects"))},s.onsuccess=function(){n.result.close()}}},H=function(){var t=j();t.onsuccess=function(){var n=t.result.transaction("projects","readonly"),s=n.objectStore("projects").getAll();s.onsuccess=function(){(e=s.result.length,0==s.result.length)?m.innerHTML='<div class="ue-empty-state"><img></img><p>You killed all the projects, Try refreshing or creating a new project.</p></div>':(m.innerHTML="",s.result.forEach(function(e){""==e.title&&(e.title="Unnamed Project");var t=document.createElement("li");t.innerHTML=`<span class="ue-ic ue-ic-trash" data-project-id="${e.id}"></span><span data-project-id="${e.id}" class="ue-project-name">${e.title}</span>`,m.appendChild(t)}))},n.onsuccess=function(){t.result.close()}}};v.addEventListener("click",function(){b(L="workspace"),t.dataset.projectId=Date.now(),t.innerHTML="",f.forEach(function(e){e.innerHTML="<ul><li></li></ul>"})}),t.onkeydown=function(){x()},f.forEach(function(e){e.onkeyup=function(){q(),"<div><br></div>"==e.innerHTML|""==e.innerHTML&&(e.innerHTML="<ul><li></li></ul>"),x()}}),window.addEventListener("focus",function(){M(),H(),T(),t.focus()}),H(),(k=j()).onsuccess=function(){var e=k.result.transaction("config","readonly"),n=e.objectStore("config").get("2");n.onsuccess=function(){n.result?(t.dataset.projectId=n.result.lastHistory,T()):T()},e.onsuccess=function(){k.result.close()}},M(),window.addEventListener("click",function(e){var n,s;e.target;(e.target.matches(".ue-project-name")&&(t.dataset.projectId=e.target.dataset.projectId,T(),b(L="workspace")),e.target.matches(".ue-ic-trash"))&&(1==window.confirm("Are you sure you want to delete the project?")&&(n=e.target.dataset.projectId,(s=j()).onsuccess=function(){var e=s.result.transaction("projects","readwrite");e.objectStore("projects").delete(n),H(),e.onsuccess=function(){s.result.close()}},t.dataset.projectId="unset",H()))});var C,q=function(){y.classList.contains("ue-toolbar-visible")&&y.classList.remove("ue-toolbar-visible"),I.style.display="block",D.style.display="none"},A=window.getSelection(),I=document.querySelector(".ue-style"),D=document.querySelector(".ue-colors");f.forEach(function(e){e.addEventListener("mouseup",e=>{var t=(C=A.getRangeAt(0)).getBoundingClientRect();C.endOffset-C.startOffset&&(y.style.left=`${t.x}px`,y.style.top=`${t.y-t.height/2-40}px`,y.classList.add("ue-toolbar-visible"))})});var N=function(e,t,n){var s=document.createElement("span");s.style[e]=t,1==n&&(s.style.color="rgba(0,0,0,.86)"),s.appendChild(C.extractContents()),C.insertNode(s),x()};document.addEventListener("mousedown",function(e){var t=e.target;if(t.matches(".ue-ic-bold")||t.matches(".ue-ic-italic")||t.matches(".ue-ic-highlight")||t.matches(".ue-ic-clear")||t.matches(".ue-color")){if(null!=C){if(t.classList.contains("ue-ic-bold")&&N("fontWeight","bold"),t.classList.contains("ue-ic-italic")&&N("fontStyle","italic"),t.classList.contains("ue-ic-clear")){var n=document.createTextNode("span");n.textContent=C.extractContents().textContent.replace(/\n/g,""),C.commonAncestorContainer.parentNode.hasAttribute("style")&&(C.commonAncestorContainer.parentNode.style=""),C.insertNode(n),x()}t.classList.contains("ue-ic-highlight")&&(I.style.display="none",D.style.display="block"),t.classList.contains("ue-color")&&(N("background",t.dataset.color,!0),I.style.display="block",D.style.display="none")}}else q()})};window.addEventListener("DOMContentLoaded",initHandler);